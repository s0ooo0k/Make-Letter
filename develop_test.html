<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MAKE LETTER</title>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Archivo+Narrow:ital,wght@0,400..700;1,400..700&family=Kumar+One&family=Noto+Sans+KR:wght@100..900&family=Roboto:ital,wght@0,100..900;1,100..900&display=swap");
    </style>
    <link
      rel="icon"
      type="image/png"
      href="./asset/favicon/favicon-96x96.png"
      sizes="96x96"
    />
    <link rel="icon" type="image/svg+xml" href="./asset/favicon/favicon.svg" />
    <link rel="shortcut icon" href="./asset/favicon/favicon.ico" />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="./asset/favicon/apple-touch-icon.png"
    />
    <link rel="manifest" href="./asset/favicon/site.webmanifest" />
    <!-- OG Image -->
    <meta property="og:title" content="MAKE JOB LETTER" />
    <meta
      property="og:description"
      content="취준생이신가요? AI 자소서의 도움을 받으세요!"
    />
    <meta
      property="og:image"
      content="https://github.com/user-attachments/assets/b6a6524d-27eb-4391-aee0-58e29b2e32fd"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
      <div class="container">
        <a class="navbar-brand" href="index.html">
          <img src="asset/logo.png" class="d-inline-block align-text-top" />
        </a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
          aria-controls="navbarNav"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item">
              <a class="nav-link" href="develop.html">개발자</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="ohter.html">타 직종</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- main -->
    <div class="main-allign">
      <section class="form-section">
        <form id="controller" class="form-container">
          <section>
            <label>
              포지션 <br />
              <select name="position" class="form-control">
                <option value="프런트엔드">프런트엔드</option>
                <option value="백엔드">백엔드</option>
                <option value="풀스택">풀스택</option>
              </select>
            </label>
          </section>
          <section>
            <label>
              커리어 <br />
              <select name="career" class="form-control">
                <option value="주니어">주니어</option>
                <option value="팀장">팀장</option>
                <option value="시니어">시니어</option>
                <option value="CTO">CTO</option>
              </select>
            </label>
          </section>
          <section>
            <textarea
              name="briefing"
              placeholder="본인에 대한 간단한 설명을 작성해주세요!"
              class="form-control"
            ></textarea>
          </section>
          <section>
            <button class="btn btn-primary">제출</button>
          </section>
        </form>
      </section>
      <section class="print-section" id="box">
        <h3 id="basic">
          폼을 작성하고 3초 정도 기다려주세요 <br />
          분석 후 작성을 도와드리겠습니다.
        </h3>
      </section>
    </div>

    <!-- 푸터 -->
    <footer class="footer">
      <div class="container text-center">
        <p>&copy;sook. 2025 MAKE LETTER. All Rights Reserved.</p>
      </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <script>
      //   const _ = async () => {};
      //   window.onload = _;
      document.addEventListener("DOMContentLoaded", async () => {
        const addMsg = (msg) => {
          const box = document.querySelector("#box");
          const p = document.createElement("p");
          const basic = document.querySelector("basic");
          if (msg) {
            p.textContent = msg;
            box.appendChild(p);
          }
        };

        const form = document.querySelector("#controller");
        form.addEventListener("submit", async (event) => {
          event.preventDefault();
          const formData = new FormData(form); // Map 같은 느낌

          // alert(
          //   ["position", "career", "briefing"].map((key) => formData.get(key))
          // );
          // alert([...formData.keys()].map((key) => formData.get(key)));
          // const [position, career, briefing] = [...formData.keys()].map((key) =>
          //   formData.get(key)
          // ); // 배열 구조 분해 할당

          const position = formData.get("position");
          const career = formData.get("career");
          const briefing = formData.get("briefing");

          // (1) briefing에 있는 문장을 임베딩(단어를 쪼개서 토큰화를 잘 해서 의미있는 값만 해서 절약, 압축)
          // (2) position, career, briefing(emb) -> thinking -> (1) json (2) img
          const GEMINI_API_KEY = "";
          const summary = async (position, career, briefing) => {
            const model = "gemini-2.0-flash-thinking-exp-01-21";
            const url = `https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${GEMINI_API_KEY}`;
            const response = await axios.post(
              url,
              {
                contents: [
                  {
                    parts: [
                      {
                        text: `${position} 개발자의 포지션, 경력은 ${career}, ${briefing}의 내용은 개발자의 요약 소개야. 이 소개에서 중요한 키워드를 찾아내 키워드를 바탕으로 각각의 경력과 포지션에 맞는 자기소개서를 300자 이내로 작성해줘. 마크다운 언어는 빼고 평문으로만 작성해줘.`,
                      },
                    ],
                  },
                ],
              },
              {
                headers: {
                  "Content-Type": "application/json",
                },
              }
            );
            return response.data.candidates[0].content.parts[0].text;
          };
          const summerized = await summary(position, career, briefing);
          addMsg(await summerized);
        });
      });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
